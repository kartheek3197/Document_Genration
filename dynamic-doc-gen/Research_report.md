# Research Report: Dynamic Agent Orchestration in Document Generation

## Introduction

In this report, I explore **dynamic agent orchestration** as a modern AI technique and how it can enhance a multi-agent document generation pipeline. Traditional prompt usage involves a fixed sequence of steps, but dynamic orchestration allows an AI system to decide which agents (or functions) to invoke and in what order, based on the content and context. This flexibility can make the document generation more intelligent and adaptable.

## Chosen Technique: Dynamic Agent Orchestration

**Dynamic agent orchestration** refers to the ability of an AI system to **dynamically select and coordinate multiple sub-agents or tools** in order to fulfill a complex task. Instead of a predetermined pipeline, the AI can make decisions on the fly about which component to use. Recent advances like OpenAI's function calling API and frameworks such as LangChain have demonstrated how an AI model (like GPT-4) can act as a **controller agent**, deciding how to break a task into sub-tasks and which functions (agents) to call to complete each sub-task.

For example, OpenAI's function calling feature allows developers to define a set of functions (tools) that the model can invoke. The model can then choose to call one or more functions during a conversation to retrieve data or perform actions. This essentially turns the model into an orchestrator of tools. In the context of document generation, this means the AI itself could decide which section to generate next or whether a particular section is needed at all.

## Benefits to Document Generation Pipeline

Adopting dynamic orchestration can bring several benefits to our pipeline:
- **Adaptive Content**: The system can decide which sections are relevant based on input. For instance, if a project is residential, an orchestrator agent could skip the commercial standards section automatically (as we have partially implemented with a simple conditional in our code). With AI orchestration, this decision could be made by the model analyzing the request context, without hard-coded rules.
- **Reduced Development Effort**: Instead of writing complex conditional logic for every scenario, we can rely on the AI's reasoning capabilities to choose the needed components. This makes the system easier to extend; adding a new section agent means the orchestrator AI could call it when appropriate.
- **Improved Consistency and Context Awareness**: An AI orchestrator can maintain a high-level understanding of the document as a whole. It could ensure that the content generated by different agents is consistent (e.g., terminology or tone) by adjusting prompts or adding context for subsequent agents. Essentially, the orchestrator can act like a "project manager" agent, keeping track of what has been done and what's next.

## Integration into Our System

In the current implementation, our orchestrator (in `app/services/orchestrator.py`) uses a static concurrency approach (async `gather`) and some simple conditional logic for including sections. To integrate a more dynamic approach, we could introduce an AI-based decision step. For example:

1. **Planning Phase**: Use an AI model to read the initial request and determine which sections should be generated. This could be done via a prompt like: *"Given the following project details, list which document sections are needed (e.g., Header, Zoning, Commercial Standards, General Standards)."* The AI would output the list of sections to include.
2. **Execution Phase**: Based on the AI's plan, invoke the corresponding agent functions to generate each section. This could either be done by our code (parsing the plan output), or by using the AI's function calling ability to directly invoke the agent functions as it decides on them.
3. **Iterative Refinement**: The orchestrator agent (the AI) could then review the assembled content and possibly request revisions. For instance, it might detect that a section is too lengthy or missing some detail and then trigger a specific agent to refine that section.

### Prototype Snippet: AI-Driven Section Planning
Below is a conceptual code snippet demonstrating how we might employ an LLM to dynamically decide on sections:

```python
import openai

planning_prompt = [
  {"role": "system", "content": "You are an expert document planner."},
  {"role": "user", "content": (
       "Project Type: Residential\n"
       "Task: Decide which sections are needed for the report (Header, Zoning, Commercial Standards, General Standards). "
       "List only the sections that should be included for this project type."
   )}
]
response = openai.ChatCompletion.create(model="gpt-4", messages=planning_prompt)
plan = response["choices"][0]["message"]["content"]
print(plan)
```

If the project is residential, the AI might respond with:
```
Include: Header, Zoning, General Standards. (Commercial Standards not applicable.)
```
Our code could parse this result and know to skip the commercial standards generation. This is a simple example, but it shows the principle of letting the AI dynamically control the flow.

### Advanced Orchestration with Tools
Another powerful approach is using the AI with tools. Using OpenAI's function calling or a framework like LangChain, we can register each section generator as a *function* that the AI can call. The model could be prompted with the overall goal ("Generate the full document") and it would internally decide: "First, I need to call the header generation function. Next, the zoning function..." and so on. This effectively gives us an **AI-driven orchestration**, where the model is not just producing content but also controlling which agents are used in real-time. 

Such a system resembles **AutoGPT-like agents**, which plan and execute tasks iteratively. While our current implementation does not fully implement an AI decision loop, these ideas could be integrated in the future. For instance, the validation agent could be enhanced by using the LLM to critique and fix issues in the content (a technique sometimes called *self-refinement* or *reflection*).

## Conclusion

Dynamic agent orchestration is an exciting technique that adds adaptability and intelligence to multi-agent pipelines. By allowing an AI model to serve as an orchestrator, we can create a document generation system that is more flexible in handling different scenarios and can potentially make high-level decisions that ensure the final document is coherent and relevant. Our project lays the groundwork with a modular agent design, and with further integration of AI-based planning (using function calling or advanced prompting), it can evolve into a truly smart document generation assistant.
